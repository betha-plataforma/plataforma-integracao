!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@angular/common"),require("@angular/common/http"),require("rxjs"),require("rxjs/operators"),require("@betha-plataforma/oauth")):"function"==typeof define&&define.amd?define("@studio/ui-angular-autenticacao",["exports","@angular/core","@angular/common","@angular/common/http","rxjs","rxjs/operators","@betha-plataforma/oauth"],t):t(((e=e||self).studio=e.studio||{},e.studio["ui-angular-autenticacao"]={}),e.ng.core,e.ng.common,e.ng.common.http,e.rxjs,e.rxjs.operators,e.oauth)}(this,(function(e,t,o,r,n,i,a){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */var s=function(){return(s=Object.assign||function(e){for(var t,o=1,r=arguments.length;o<r;o++)for(var n in t=arguments[o])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)};var c=new t.InjectionToken("OauthApplication"),u=function(){function e(e){var t=this;this.oauthApplication=e,this.getInformacaoUsuario=function(){var e=t.oauthApplication.getUser();return n.of({celular:e.cellPhone,dataNascimento:e.birthDay,emails:{primario:e.email,secundario:e.secondaryEmail},foto:e.photo.split("?")[0].concat("?access_token=").concat(t.getAccessToken()),id:e.id,nome:e.name})},this.getAccessToken=function(){if(t.oauthApplication.hasActiveSession()){var e=t.oauthApplication.getSession().accessToken;return e?e.access_token:void 0}}}return e.prototype.logout=function(){this.oauthApplication.logout()},e.prototype.refreshToken=function(){return this.oauthApplication.silentRefresh()},e.decorators=[{type:t.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[{type:a.OAuthApplication,decorators:[{type:t.Inject,args:[c]}]}]},e.ngInjectableDef=t.ɵɵdefineInjectable({factory:function(){return new e(t.ɵɵinject(c))},token:e,providedIn:"root"}),e}();var h=function(){function e(e){this.authenticationContextService=e,this.refreshTokenInProgress=!1,this.tokenRefreshedSource=new n.Subject,this.tokenRefreshedSource$=this.tokenRefreshedSource.asObservable()}return e.prototype.intercept=function(e,t){var o=this;return t.handle(this.addAuthRequest(e)).pipe(i.catchError((function(r){return[401,410].includes(r.status)?o.refreshToken(e,t).pipe(i.switchMap((function(){return t.handle(o.addAuthRequest(e))})),i.catchError((function(e){return o.authenticationContextService.logout(),n.throwError(e)}))):n.throwError(r)})))},e.prototype.refreshToken=function(e,t){var o=this;return this.refreshTokenInProgress?new n.Observable((function(e){o.tokenRefreshedSource$.subscribe((function(){e.next(),e.complete()}))})):(this.refreshTokenInProgress=!0,n.from(this.authenticationContextService.refreshToken()).pipe(i.tap((function(){o.refreshTokenInProgress=!1,o.tokenRefreshedSource.next()})),i.catchError((function(e){return o.refreshTokenInProgress=!1,o.authenticationContextService.logout(),n.throwError(e)}))))},e.prototype.addAuthRequest=function(e){return e.clone({setHeaders:{Authorization:"Bearer "+this.authenticationContextService.getAccessToken()}})},e.decorators=[{type:t.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[{type:u}]},e.ngInjectableDef=t.ɵɵdefineInjectable({factory:function(){return new e(t.ɵɵinject(u))},token:e,providedIn:"root"}),e}();var p=function(){function e(){}return e.decorators=[{type:t.NgModule,args:[{declarations:[],imports:[o.CommonModule],providers:[{provide:r.HTTP_INTERCEPTORS,useClass:h,multi:!0}]}]}],e}();var f=window.___bth.envs.suite.oauth.v1.host,d=window.___bth.envs.suite["service-login"].v1.host,l=window.___bth.envs.suite.usuarios.v1.host;e.AutenticacaoContextService=u,e.AutenticacaoModule=p,e.OAUTH_APPLICATION=c,e.bethaOIDCProviderFactory=function(e){var t={authorization_endpoint:f+"/authorize",check_session_iframe:d+"/openidsso.jsp",end_session_endpoint:d+"/logout?continue="+f+"/authorize?client_id="+e.clientId+"%26response_type=token%26redirect_uri="+e.redirectUri+"%26scope="+e.scope,introspect_endpoint:f+"/tokeninfo",token_endpoint:f+"/token",userinfo_endpoint:l+"/api/usuarios/@me"};return s({},e,{provider:t})},e.ɵa=h,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=studio-ui-angular-autenticacao.umd.min.js.map